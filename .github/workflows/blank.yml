name: build
on: workflow_dispatch

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          submodules: recursive
      - name: Run a multi-line script
        run: |
          git clone https://github.com/Nature40/pimod.git \
          cd pimod \
          sudo apt-get install \
          binfmt-support \
          fdisk \
          file \
          kpartx \
          lsof \
          p7zip-full \
          qemu-user-static \
          unzip \
          wget \
          xz-utils \
          units
          
          echo "\n \
            FROM 2018-11-13-raspbian-stretch-lite.img\n" \
            PUMP 100M\n \
            RUN raspi-config nonint do_serial 0\n \
            \n \
            RUN apt-get update\n \
            RUN bash -c 'DEBIAN_FRONTEND=noninteractive apt-get -y dist-upgrade'\n \
            RUN apt-get install -y sl\n \
            " > pilite.Pifile \
            
            sudo ./pimod.sh pilite.Pifile \ 
            dd if=Upgrade.img of=/dev/sdc bs=4M status=progress \
